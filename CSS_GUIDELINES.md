# CSS分割・改修のための参照元調査と絶対条件ガイド

## 目的

本資料は、既存CSSを分割・整理・改修する際に**デザイン崩れや挙動変更を防ぐこと**を最優先とし、AI(コーディネーター/自動化ツール)に作業を委任する場合でも**安全に進めるための汎用的な指南書**である。

本ガイドは、特定のプロジェクトやコード構成を前提としない。今後あらゆるWebアプリケーション/Web UIに再利用できることを目的とする。

---

## 基本思想(最重要)

- CSSは**宣言順・構造・状態**に依存する
- 見た目が同じでも、CSSの評価条件が変わると挙動は破壊される
- CSS分割は「設計作業」ではなく、**設計に基づく物理作業**である

したがって、

> **参照元を調べずにCSSを分割してはならない**

---

## 第1章:CSSの参照元とは何か

CSSの「参照元」とは、単にHTML内のclassやidを指すものではない。実務上、CSSが成立する根拠は複数のレイヤーに分散している。

### 1.1 参照元の種類

CSS参照元は、必ず以下の系統に分類できる。

| 区分 | 内容 | 代表例 |
|------|------|--------|
| HTML構造 | 静的DOMの構造・順序 | 親子・兄弟・隣接関係 |
| JS(状態) | class / attribute の付与・除去 | `.visible`, `body.xxx` |
| JS(変数) | CSS変数の操作 | `style.setProperty('--var')` |
| JS(生成) | DOMの動的生成 | `innerHTML`, `createElement` |
| 外部DOM | iframe・外部スクリプト | OAuth、埋め込み |
| CSS内部 | 上書き・モード・メディア | theme, state, media |

**CSSは単独では完結しない**ことを常に前提とする。

---

## 第2章:参照元調査フェーズ(分割前に必須)

### 2.1 調査フェーズの位置付け

CSSを分割・整理する前に、必ず「参照元調査フェーズ」を設ける。このフェーズでは**一切の分割・編集を行わない**。

目的は以下の一点に集約される。

> 各スタイルブロックが「何に依存して成立しているか」を明文化する

---

### 2.2 調査対象(最低限)

以下を調査対象として揃える。

- CSS全文
- HTML(静的テンプレート)
- JavaScript(以下を含むファイル)
  - class操作
  - CSS変数操作
  - DOM生成

---

### 2.3 CSSブロック単位での調査

調査は「ファイル単位」ではなく、**スタイルブロック単位**で行う。

対象例:

- セレクタ1つ
- 複数セレクタの集合(同一責務)
- 状態上書きの塊

---

## 第3章:参照元情報の付記ルール

### 3.1 付記の基本形式

各スタイルブロックの直前に、コメントとして参照元情報を付記する。

```css
/* =====================================
[REF]
- HTML: 親子/兄弟/順序依存の有無
- JS: class操作/変数操作/DOM生成
- STATE: 状態クラス・モード依存
- LAYER: z-index・重なり制御
- SPLIT: SAFE | GROUP | LAST
===================================== */
```

---

### 3.2 各項目の意味

#### HTML

- 静的に存在する要素か
- DOM構造(親子・兄弟・隣接)への依存有無

#### JS

- classList操作の有無
- CSS変数操作の有無
- 動的生成要素への依存

#### STATE

- 状態クラス(表示/非表示/モード)
- body直下クラスの影響

#### LAYER

- z-index管理
- overlay / modal / menu 等との前後関係

#### SPLIT

- `SAFE`:単独ファイル化しても安全
- `GROUP`:他ブロックと同一ファイル保持必須
- `LAST`:必ず後段で評価される必要あり

---

## 第4章:CSSを扱う際の絶対条件(汎用)

### 4.1 内容変更に関する禁止事項

以下は**作業失敗とみなす**。

- セレクタの変更・整理・統合
- プロパティ/値の変更(数値・単位・色含む)
- CSS変数の追加・削除・改名・集約
- 未使用判断による削除
- `@keyframes` の整理・統合
- `!important` の追加・削除
- 自動フォーマットの適用

---

### 4.2 順序と評価に関する絶対条件

- CSSは**元の出現順を100%保持**する
- 分割後も**同じ順序で評価される**ことを保証する
- 状態上書き・モードCSSは必ず後段に配置する

---

### 4.3 分割作業の性質

- 分割は**コピー&ペースト作業**である
- 設計判断・最適化は禁止
- 分類のために順序を変更してはならない

---

## 第5章:分割前後の作業フェーズ定義

### フェーズ1:参照元調査(必須)

- CSS編集禁止
- 参照元コメント付記のみ

### フェーズ2:分割計画

- SPLIT区分に基づきファイル構成を決定
- 読み込み順を確定

### フェーズ3:物理分割

- 内容変更なし
- 順序維持

### フェーズ4:検証

- 状態遷移・重なり・モード切替を中心に確認

---

## 第6章:このガイドを使う際の注意点

- CSSが巨大であるほど、参照元調査の価値は高い
- AIは「理由」が明示されていないと最適化を行う
- 本資料は**AIの暴走を防ぐための設計書**として機能する

---

## 結語

CSSの分割・整理で失敗する原因の大半は、

> 「どこで、なぜ、そのCSSが効いているか」を把握せずに触ること

にある。

参照元調査と条件定義を先に行えば、

- 分割は安全な事務作業になり
- デザイン崩れは再現性をもって防止できる

本ガイドは、そのための**共通基盤**である。
