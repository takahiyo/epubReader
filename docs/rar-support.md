# RAR 代替手段の評価と対応方針

## 前提
- 現行実装は `node-unrar-js` を用いた RAR 展開で、**File/Blob を ArrayBuffer 化してから展開**する方式。ストリーミング展開は不可。
- RAR は **solid（連続圧縮）** の場合、途中ページのみ取り出すにも先頭からの展開が必要。

## 代替手段の評価

### 1. libarchive / 7zip 系 WASM を Blob から扱う
**評価**
- libarchive / 7zip 系の WASM で ZIP/7z を扱える可能性はあるが、RAR 対応はライブラリ・ライセンス・機能差の影響が大きい。
- RAR 対応ができたとしても、**WASM 版がストリーミング読み出しを提供する保証はない**。

**結論**
- **RAR 対応の可否が不確実**で、導入コストと検証負荷が大きい。現時点では主軸にしない。

### 2. FileSystem Access API + ファイル分割読み出し
**評価**
- ファイルを分割読み出しできるが、**RAR はストリーミング展開が難しい**。
- **solid RAR では先頭から展開が必要**なため、結局全体読み込みに近い挙動になりやすい。
- ブラウザ互換性（Safari など）で制約がある。

**結論**
- 大容量ファイルのメモリ使用を抑えられる可能性はあるが、**solid RAR では効果が限定的**。

### 3. サーバーサイド変換（RAR → ZIP）/ ユーザー変換ガイド提示
**評価**
- サーバー側で ZIP に変換すれば、クライアントは ZIP と同様にストリーム可能。
- ただしサーバーコストやセキュリティ面の配慮が必要。
- ユーザーに変換を促すガイド提示なら、サーバー負荷は不要。

**結論**
- **現実的な回避策として有効**。ユーザーガイドを提供し、必要ならサーバー変換も検討。

## 対応方針（段階的）
1. **現行の RAR 対応維持 + UI 警告**
   - ハンドラ初期化時に以下を明示:
     - RAR はストリーミング不可（全体読み込みが必要）
     - solid RAR の場合は全展開が必要
2. **ユーザーガイドの提示**
   - RAR → ZIP 変換手順（7-Zip など）を案内。
3. **必要に応じてサーバー変換を検討**
   - サーバーサイドでの変換導入は運用コスト・セキュリティを踏まえて判断。

## UI 警告表示
- RAR ハンドラ初期化時に警告バナーを表示する。
- 警告内容:
  - **「RAR はストリーミング不可」**
  - **「solid RAR は全展開が必要」**
