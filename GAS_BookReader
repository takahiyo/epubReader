function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  const user = Session.getActiveUser().getEmail();

  const key = user + ":" + data.bookId;

  const props = PropertiesService.getScriptProperties();
  props.setProperty(key, JSON.stringify(data));

  return ContentService.createTextOutput(
    JSON.stringify({ ok: true, ts: Date.now() })
  ).setMimeType(ContentService.MimeType.JSON);
}

function doGet(e) {
  const user = Session.getActiveUser().getEmail();
  const bookId = e.parameter.bookId;
  const key = user + ":" + bookId;

  const props = PropertiesService.getScriptProperties();
  const data = props.getProperty(key);

  return ContentService.createTextOutput(data || "{}")
    .setMimeType(ContentService.MimeType.JSON);
}
